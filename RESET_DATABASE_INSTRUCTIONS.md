# تعليمات إعادة تعيين قاعدة البيانات في الإنتاج

## 📋 نظرة عامة
هذا الدليل يشرح كيفية استخدام سكريپت إعادة تعيين قاعدة البيانات في بيئة الإنتاج لنظام Norko Store.

## ⚠️ تحذير مهم
**هذا السكريپت سيمحو جميع البيانات في قاعدة البيانات بشكل نهائي!**
- جميع المنتجات والمبيعات
- جميع العملاء والفواتير  
- جميع التقارير والإحصائيات
- **لا يمكن استرداد البيانات بعد الحذف!**

## 📁 الملفات المطلوبة
تأكد من وجود الملفات التالية:
```
reset_production_database.py    # السكريپت الرئيسي
reset_production.sh            # سكريپت Bash (للسيرفرات Linux)
app.py                        # تطبيق Flask
models.py                     # نماذج قاعدة البيانات
```

## 🚀 طريقة الاستخدام

### على سيرفرات Linux:
```bash
# 1. رفع الملفات إلى السيرفر
scp reset_production*.py reset_production.sh user@server:/path/to/app/

# 2. الاتصال بالسيرفر
ssh user@server

# 3. الانتقال إلى مجلد التطبيق
cd /path/to/app/

# 4. إعداد متغيرات البيئة
export FLASK_CONFIG=production
export DATABASE_URL=your_database_url

# 5. اختبار الاتصال أولاً (اختياري)
./reset_production.sh --test-only

# 6. تشغيل السكريپت
./reset_production.sh
```

### على Windows:
```cmd
# 1. إعداد متغيرات البيئة
set FLASK_CONFIG=production
set DATABASE_URL=your_database_url

# 2. تشغيل السكريپت مباشرة
python reset_production_database.py
```

## 🔧 خطوات عملية إعادة التعيين

### 1. التحققات الأولية
- فحص البيئة والملفات المطلوبة
- اختبار اتصال قاعدة البيانات
- التحقق من الصلاحيات

### 2. النسخ الاحتياطي التلقائي
- إنشاء نسخة احتياطية من الملفات
- حفظ بيانات المستخدمين والفئات
- إنشاء ملف معلومات النسخة

### 3. عملية إعادة التعيين
- حذف جميع الجداول الموجودة
- إنشاء الجداول الجديدة من الصفر
- استعادة البيانات المهمة
- إنشاء البيانات الافتراضية

### 4. اختبار النظام
- التحقق من إنشاء الجداول
- اختبار الاتصالات
- عرض إحصائيات النظام

## 📝 تأكيدات الأمان

السكريپت يطلب تأكيدات متعددة:

1. **التأكيد الأول**: كتابة "نعم متأكد"
2. **تأكيد البيئة**: كتابة اسم البيئة الحالية
3. **التأكيد النهائي**: كتابة "RESET_NOW"

## 📊 ما يحدث بعد إعادة التعيين

### البيانات المستعادة:
- ✅ المستخدمين وكلمات المرور
- ✅ فئات المنتجات الأساسية
- ✅ إعدادات النظام

### البيانات المحذوفة:
- ❌ جميع المنتجات
- ❌ جميع المبيعات والفواتير
- ❌ جميع العملاء
- ❌ جميع التقارير والإحصائيات

## 🔄 الخطوات بعد إعادة التعيين

1. **تسجيل الدخول**
   ```
   المستخدم: admin
   كلمة المرور: admin123
   ```

2. **التحقق من النظام**
   - فحص قائمة المستخدمين
   - التأكد من وجود الفئات
   - اختبار إضافة منتج تجريبي

3. **استيراد البيانات**
   - استخدام ميزة "استيراد من Excel"
   - رفع ملف المنتجات
   - التحقق من نجاح الاستيراد

4. **الاختبار النهائي**
   - اختبار المبيعات
   - اختبار التقارير
   - اختبار النسخ الاحتياطي

## 📂 مواقع الملفات المهمة

```
backups/YYYYMMDD_HHMMSS/     # النسخ الاحتياطية
database_reset_*.log         # ملفات السجل
backup_before_reset_*.json   # نسخة احتياطية من البيانات
```

## 🆘 حل المشاكل

### مشكلة: فشل الاتصال بقاعدة البيانات
```bash
# التحقق من متغيرات البيئة
echo $DATABASE_URL
echo $FLASK_CONFIG

# اختبار الاتصال
./reset_production.sh --test-only
```

### مشكلة: خطأ في الصلاحيات
```bash
# إعطاء صلاحيات التشغيل
chmod +x reset_production.sh

# التحقق من الصلاحيات
ls -la reset_production*
```

### مشكلة: فشل في استعادة البيانات
```bash
# البحث عن النسخ الاحتياطية
ls -la backup_before_reset_*.json

# استعادة يدوية من النسخة الاحتياطية
python -c "
import json
with open('backup_before_reset_TIMESTAMP.json', 'r') as f:
    data = json.load(f)
    print('المستخدمين:', len(data['users']))
    print('الفئات:', len(data['categories']))
"
```

## 📞 الدعم الفني

في حالة حدوث مشاكل:

1. **احفظ ملفات السجل**
   ```bash
   cp database_reset_*.log error_logs/
   ```

2. **انسخ رسائل الخطأ** كاملة

3. **تحقق من النسخ الاحتياطية**
   ```bash
   ls -la backups/
   ```

4. **أرسل المعلومات التالية:**
   - نظام التشغيل
   - إصدار Python
   - رسائل الخطأ
   - ملفات السجل

## ⚡ نصائح مهمة

1. **اختبر في بيئة التطوير أولاً**
2. **تأكد من وجود نسخة احتياطية حديثة**
3. **قم بالعملية في وقت صيانة**
4. **أعلم المستخدمين مسبقاً**
5. **اختبر النظام كاملاً بعد إعادة التعيين**

---
*آخر تحديث: $(date)* 